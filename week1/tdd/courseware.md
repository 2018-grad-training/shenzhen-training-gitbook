# 课件

这其实是一份讲课大纲。

## 讲课大纲

* 什么是 TDD - 这节主要讲理论，花大概 3-5 分钟。主要目的：让学生觉得 TDD 是正确的、不得不做的事情。
  * 先写测试，后写实现的开发方式
  * 有没有发现，Tasking 还没有回答一个问题。它回答了「做完什么算做完」这个问题，让你知道应该做什么。但它回答不了的问题是，「怎么知道你做完了」没有呢？我怎么验收呢？你说我做完了，那么为什么 QA 不相信你呢？十几乃至几十年来软件工程用的方式是开发手动自测+测试部门测试。这种方式，也不说 low，但它有很多问题解决不了，比如部门墙、不能自动化回归、缓慢的响应速度，对于互联网时代快速增长、变化的业务需求已经显得笨重了，这就是我们说的「组织响应力」太慢。我们需要更现代的开发理念和实践来解决这个问题。所以，大家在现代了，要用更先进的方式来解决问题了。现代的方式是什么呢？TDD 是其中一个重要的基石
  * 测试先行——我们讲的测试是可以自动化运行的——就是用自动化的方式，来回答「我做完了」这个问题。自动化的测试顺便还能做回归用，为老功能保驾护航，实际上是提升了应用整体的响应力
* TDD 的好处
  * 测试可以自动化地、可靠地回答「你是否做完了」这个问题
  * 利于回归和重构 - 没有测试的项目只能腐化
  * 小步前进、终结调试
  * 测试即文档
  * 信心
* 如何做 TDD
  0.  步骤
      * 先写一个失败的测试
      * 编译代码，使测试变红
      * 写最小的实现代码
      * 编译代码，使测试通过
      * 重构代码，保持测试通过
  1.  三原则：
      * 没有红的测试不写代码（也就是先写测试。因为没有红的测试，说明你没有需要验收的东西嘛；如果你写了代码但没有测试，那就说明它们没法被自动化验收嘛；这也是 TDD 神教的口号）
      * 只允许编写刚好能使实现挂掉的测试代码（很好，小步前进，防止你一次实现太多）
      * 只允许编写刚好能使测试通过的产品代码（我认为这点可以根据能力和对需求可能变化点的经验灵活掌握，是否可以不用在课上过多强调这点）
  1.  tasking - 测试用例（想想如何验收你的 tasking） - 因此例子要尽量使用没有 GUI 的
  1.  红绿-重构循环
  1.  前端测试框架讲解、如何实际上手：引出 jest 和断言语法、测试的三段式、好测试的特征
* 例子演练 I：FizzBuzz - 这步操练到 tasking 和测试用例
* 重构
  * 什么时候进行重构？
  * 有什么坏味道
    * 重复代码
    * 过长函数
    * 变量命名
  * 重构的定义是什么？
  * 没有测试叫不叫重构？
  * 重构的目标是什么——整洁代码、DRY 的代码、SRP 的代码、易于可预见的扩展
  * 重构要基于事实来，不要臆想，扎实地进行合理的需求预测
* 例子演练 II：重构 FizzBuzz？ - 这步操练到重构相关。可以引入一下重构相关的东西。不过，重构分出第二步来讲，会不会给学生一种印象 - 重构不在红绿循环之内？另外是，可以加需求，让他们意识到重复的点在面对需求变更时需要的修改，从而有目的地对变化点进行抽象重构，而不是基于臆想。不过，这样的话，是不是就需要真实的例子？
* 测试金字塔
* stub & mock - 什么时候讲？FizzBuzz 里不会遇到
* 例子演练 III ：POS 机 - 涉及 mock 和 stub
* TDD 的缺点 - 什么场景不适合用 TDD
  * 前端少不了 UI 怎么办？
  * 学习成本和学习曲线

## 验收标准

* [x] 知不知道什么是 TDD，会不会做 TDD——安排练习；站会学习；课程结束分享；
* [x] 是否了解做 TDD 的好处：快速反馈、测试即文档、自动化回归——站会学习；课程结束分享；
* [x] 会不会做 TDD 的先写测试，后写简单实现，然后重构——安排课堂练习，轮流上去做；课后作业；
* 会不会重构：识别出坏味道，在有测试保障的情况下重构代码——安排课堂练习，轮流上去做；课后作业；
* [x] 会不会小步提交：一次写一个测试、实现、重构，不行了马上 checkout 代码或简单实现重新来——安排课堂练习，轮流上去做；课后作业；
* [x] 是否掌握了测试金字塔——可能没法验收，就是提一嘴
* [x] 是否掌握了 mock/stub 技术——安排课堂练习；可能没法验收，就是提一嘴；
* [x] 是否了解 TDD 的缺点——怎么验收？

所以总结下来，需要安排三个练习：

1.  [x] 基本的 TDD 练习，需要很简单，没有 mock，没有 UI，不需要重构也可以完成作业
2.  [x] 重构的练习，用 word frequency 那个例子，讲解简单命名、重复代码
3.  含有 mock 技术的 TDD 练习（但不要涉及控制台以外的 UI）

初步的想法是，1、2 个例子使用 FizzBuzz，第 3 个例子使用 POS 机。

## Q & A

> 不做 TDD 行不行/上了项目发现实际大家都不在做？

其实这是一个很普遍、可能也很重要的问题。我也没想好怎么回答。但可能有几点：

* 前期建立信任感、文化认可，最好的是避免生出这样的疑问？
* 反过来又想，这个东西其实是避不过去的，你上了项目，一定会遇到。这个时候不讲清楚，是不是反而少了一次树立信心的机会？
* 这样想来，首先，肯定「这是一个好问题。特别高兴你问了这个问题，说明大家也很关心这个问题」，让我有个机会可以来回答一下
* 从历史发展的角度来讲，也许这是一个必然现象，文化稀释，技能失传…但是不是意味着这个事情就错了，就没有意义了，就因此否定了我们过去一直在推广的敏捷实践呢？我认为不是的
* 那为什么会出现这样的情况呢？正确的做法是怎么样呢？我们前面讲了那么多敏捷的现代的搞法，就是我们的价值观：快速试错，快速验证，快速响应。这是个大的目标，而 TDD 就是个必然的东西。是对的
* 所以，自己要尽量成为有技术价值观的开发者，而不是随波逐流。跟别人是不用比的，要比的是自己，你有没有学更好的技术，有没有一直走在行业的前沿？
* 对同学们的厚望。投入最好的讲师最好的培训给到同学们，就希望未来你们能成为中坚力量，希望你们能一直坚持正确的事情，希望你们能克服各种难题坚持卓越
* 简直像在洗脑。所以，这个回答的风格应该是怎么样？
* 走路和摩托车的例子
